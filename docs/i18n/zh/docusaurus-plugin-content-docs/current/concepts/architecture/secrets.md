---
title: 机密处理
---

在本章中，你可以找到ZITADEL是如何以安全的方式处理和储存秘密和凭据的。

:::info
我们使用了可互换的术语和凭据来保存本指南。
:::

## 秘密原则

ZITADEL在处理其整个生命周期的秘密时使用以下原理：

- 自动旋转
- 限制生存期
- 只显示一次
- 喜欢公钥/私钥概念 (FIDO2, U2F, JWT Profile, ...)
- 不可逆转的哈希密文 / 密码
- 加密存储
- 当通过不安全的频道 (eail, SMS, ...) 发送时
  - 通过接收器强制更改
  - 验证密钥只能使用一次

## 秘密存储

默认情况下，ZITADEL储存来自用户的秘密，客户端以及它生成的秘密，如数据库中的签名密钥。 为了保护机密不受从数据库和数据库转储的提取，它们被AES256加密。

:::info
用于加密和解密ZITADEL数据库中机密的密钥被调用 `masterkey` 并且需要恰当的32字节长。 存储在保密存储之外的唯一机密是主密钥、TLS密钥、初始管理用户(包括密码) ::

## 存储在秘密存储中

### 公钥

ZITADEL确实处理许多不同的公钥。 这些措施包括：

- FIDO2
- U2F
- JWT 配置文件
- 签名密钥

::info  
由于公钥固有的性质，我们用我们独特的 [eventstore 概念](../eventstore/overview) 保护他们免遭恶意密钥更改。
:::

### 哈希密文

ZITADEL确实处理许多不同的密码和秘密。 这些措施包括：

- 用户认证
  - 密码
- 客户端/机认证
  - 客户端密码

:::info
ZITADEL默认使用 `加密` 以不可逆转的方式存储所有密码和客户端机密，以进一步降低秘密存储违反的风险。
:::

### 加密密钥

某些秘密不能被散列，因为它们需要以原始形式使用。 这些措施包括：

- Federation
  - 身份提供商的客户密码 (IDPs)
- 多因素身份验证
  - TOTP 种子值
- 验证密钥
  - 验证诸如eMail、Phonnumer等联系人信息
  - 验证域名所有权证明(DNS)
  - 用户正在休息帐户 (密码，MFA 重置...)
- 私钥
  - Token Signing (JWT, ...)
  - 令牌加密(用户令牌)
  - 用户代理 Cookie (Cookies) 加密
  - CSRF Cookie 加密
- 邮件提供商
  - SMTP 密码
- 短信提供商
  - Twilio API 密钥

:::info
默认情况下ZITADEL使用 `RSA256` 用于签名目的， `AES256` 用于加密 ::: :

## 隐藏存储在保密存储之外的密钥

### 主键

由于Masterkey 被用作保护保密存储的手段，它不能存储在存储中。 您在这里找到 [ZITADEL如何消耗主键](../../guides/manage/self-hosted/configure)。

### TLS 密钥材料

ZITADEL支持端到端TLS，因此它可以使用TLS密钥材料。 请查看我们的 [TLS 模式文档](../../guides/manage/self-hosted/tls_modes) 了解更多详情。

### 管理员用户

ZITADEL的初始管理员用户可以通过 [ZITADELs 配置选项](../../guides/manage/self-hosted/configure) 进行配置。

:::info
为了防止严重的违约行为，ZITADEL迫使管理员用户密码在第一次登录期间被更改。
:::

