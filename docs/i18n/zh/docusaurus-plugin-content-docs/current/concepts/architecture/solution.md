---
title: 部署
---

## 高可用性

ZITADEL可以轻松地运行高可用系统。 由于存储层需要大量提升，确保数据以同步、服务器和数据中心或区域。

视您的项目需要而定，我们的一般性建议是在同一区域的多个备用区运行ZITADEL和SITADEL存储层，或者如果您需要更高的担保，则运行多个区域的存储层。 查看 [CockroachDB 文档](https://www.cockroachlabs.com/docs/) 了解更多详情或使用 [CockroachCloud 服务](https://www.cockroachlabs.com/docs/cockroachcloud/create-an-account.html)

> 对ZITADEL的后期支持目前处于测试阶段。

## 可伸展性

ZITADEL可以在多个层面上以线性方式缩放。

- 您的计算基础结构
- 一个区域的水平
- 多个区域的水平

我们的客户可以重新使用相同的已知二进制或容器，并将其缩放到多个服务器、 数据中心和区域。 为了分配交通，已经存在的代理基础设施可以重新使用。 只需通过路径、主机名、IP地址或任何其他元数据引导流量到您选择的 ZITADEL。

> 为了提高您的服务质量，我们建议通过路径引导流量到不同的 ZITADEL部署。 [联系我们](https://zitadel.com/contact/) 免费了解详情

## 示例部署结构

### 单集群/地区

ZITADEL集群是一个高度可用的IAM系统，每个组成部分对服务交通都至少规定了三次。 由于我们的存储层(CockroachDB)依赖于Raft，建议操作奇数的存储节点，以防止“脑裂”问题。 因此，我们对Kubernetes的参考设计是有三个应用节点和三个储存节点。

> 如果您正在使用像Google Cloud Run这样的无服务器服务，您可以将ZITADEL从 0 到 1000 Pods 进行缩放，而无需在多个可用区域部署节点。

:::info
CockroachDB 需要配置地方标志来正确分布区域数据
:::

![集群结构](/img/zitadel_cluster_architecture.png)

### 多集群/地区

为了在各区域扩大ZITADEL范围，建议至少建立三个组。 我们建议运行一个奇数的存储集群(每个数据中心的存储节点)，以弥补“分割大脑”场景。 在我们的参考设计中，我们建议每个区域或提供云服务者建立一个至少三个区域的群组。

由于这种设计，甚至整个数据中心的断电也会影响最小，因为所有数据仍然存在于其他两个地点。

:::info
CockroachDB 需要配置地方标志来正确分布区域数据
:::

![多集群结构](/img/zitadel_multicluster_architecture.png)

## 无时间更新

由于身份系统往往是基础设施的关键部分，所以“零下班时间更新”是一个非常需要的功能。 ZITADEL的构建方式是，只需更新到较新版本即可在无故障的情况下执行升级。

通用更新涉及下列步骤，不需要操作者的手工干预：

- 保持旧版本运行
- 将版本与旧版本平行部署
- 新版本将开始...
  - 通过必要时更新数据库方案
  - 参加背景工作的领导人选举
- 一旦新版本准备好接受流量，它将在待命端 `/debug/准备好` 上发出此信号。
- 此时，您的网络基础设施可以发送流量到新版本

使用 [Kubernetes/Helm](../../guides/deploy/kubernetes) 或无服务器容器服务（如Google Cloud Run）的用户可以从上述进程自动化的事实中受益。

:::info
作为一个好的做法，我们建议在更新之前创建数据库备份。 还建议在升级之前在 GitHub 上阅读版本说明。 由于ZITADEL使用语义版本版本化打破任何类型的变化总是会增加主要版本(例如第2版将成为第3版)。
:::
